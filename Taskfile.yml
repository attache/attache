# https://taskfile.dev

version: "3"

tasks:
  build:cli:
    cmds:
      # generate version file
      - task: write-cli-version
      # generate additional code
      - go generate ./cmd/...
      # build & install
      - go install ./cmd/attache

  write-cli-version:
    cmds:
      - echo -e "// This file is autogenerated. DO NOT EDIT.\n\npackage main\n\n// Version for which the CLI was built\nconst Version = \"$ATTACHE_VERSION\"" > cmd/attache/version.go && gofmt -w cmd/attache/version.go
    env:
      ATTACHE_VERSION: $([ -z $(git tag --points-at HEAD) ] && echo "$(git branch --show-current)" || echo $(git tag --points-at HEAD))
